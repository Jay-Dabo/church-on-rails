<%= flash_messages container: 'container-sm' %>
<%  two_columns = can?(:manage, person) || can?(:read, Comment) %>

<div class="<%= 'container-sm' unless two_columns %>">
  <div class="row">
    <div class="col-xs-12 <%= 'col-lg-7' if two_columns %>">
      <div class="list-group mb-2">
        <div class="list-group-item active">
          <% if can? :update, @person %>
            <%= link_to edit_person_path(@person), class: 'float-xs-right btn btn-primary btn-sm btn-align-middle' do %>
              <%= fa_icon 'pencil' %> Edit
            <% end %>
          <% end %>

          Details
        </div>

        <%= list_group_fields class: 'mb-2', fields: {
            :full_name  => @person.full_name,
            'DOB'       => @person.dob&.strftime('%d %b %Y'),
            :email      => (link_to(@person.email, "mailto:#{@person.email}", class: 'dotted') if @person.email),
            :phone      => @person.phone,
            :gender     => gender_icon(@person),
            :account    => (fa_icon('check 1x') if @person.user)
        } %>
      </div>

      <% if @person.families.blank? %>
        <% if can? :create, FamilyMembership %>
          <div class="list-group mb-2">
            <div class="list-group-item active">
              <%= link_to person_families_path(@person), class: 'float-xs-right btn btn-primary btn-sm btn-align-middle' do %>
                <%= fa_icon 'address-card' %> Join
              <% end %>

              Family
            </div>
          </div>
        <% end %>
      <% else %>
        <% @person.families.each do |family| %>
          <%= render 'people/families/family_list_group', family: family %>
        <% end %>
      <% end %>

      <% if can? :read, Team %>
        <div class="list-group mb-2">
          <div class="list-group-item active">
            <% if can? :create, TeamMembership %>
              <%= link_to person_teams_path(@person), class: 'float-xs-right btn btn-primary btn-sm btn-align-middle' do %>
                <%= fa_icon 'users' %> Join
              <% end %>
            <% end %>

            Teams
          </div>

          <div class="list-group">
            <%= render partial: 'people/teams/team_item', collection: @person.teams %>
          </div>
        </div>
      <% end %>

      <% if can? :read, PersonProcess %>
        <div class="list-group mb-2">
          <div class="list-group-item active">
            <% if can? :create, PersonProcess %>
              <%= link_to new_person_person_process_path(@person), class: 'float-xs-right btn btn-primary btn-sm btn-align-middle' do %>
                <%= fa_icon 'arrow-right' %> Start
              <% end %>
            <% end %>

            Processes
          </div>

          <%= render partial: 'processes/person_processes/person_process_item', collection: @person.person_processes %>
        </div>
      <% end %>
    </div>

    <div class="col-xs-12 <%= 'col-lg-5' if two_columns %>">
      <% if can?(:manage, person) && person != current_person %>
        <div class="list-group mb-2">
          <div class="list-group-item active">
            Management
          </div>
          <% unless person == current_person %>
            <div class="list-group-item">
              <%= fa_icon 'trash 1x', class: 'mr-xs' %>
              <%= link_to 'Remove person', confirm_destroy_person_path(@person) %>
            </div>
          <% end %>
        </div>
      <% end %>

      <%= render 'comments/form', resource: @person %>
    </div>
  </div>
</div>
