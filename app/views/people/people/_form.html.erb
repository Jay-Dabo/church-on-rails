<%= flash_messages %>
<%= form_for(@person) do |f| %>

  <div class="list-group mb-2">
    <div class="list-group-item list-group-item-secondary">
      <% if @person.new_record? %>
        <%= link_to 'Cancel', people_path, class: 'float-xs-right btn btn-secondary btn-sm btn-align-middle' %>
      <% else %>
        <%= link_to 'Cancel', account_or_person_path(@person), class: 'float-xs-right btn btn-secondary btn-sm btn-align-middle' %>
      <% end %>

      Details
    </div>

    <%= render 'people/people/form_fields', f: f, person: @person %>
  </div>

  <% if @person.new_record? %>
    <% if can?(:create, FamilyMembership) %>
      <div class="list-group mb-2">
        <div class="list-group-item list-group-item-secondary">
          Add to Family
        </div>
        <div class="list-group-item" id="family-picker">
          <%= f.select :family_ids, [['< Start new family >', 'New']] + Family.all.map{|family| [ family.name, family.id ] }, { include_blank: true }, class: 'form-control', data: { selectpicker: true, placeholder: 'Choose a Family', :'allow-clear' => true } %>
          <%= f.text_field :family_name, class: 'form-control mt-sm', placeholder: 'Family name' %>
        </div>
      </div>
    <% end %>

    <% if can?(:create, TeamMembership) %>
      <div class="list-group mb-2">
        <div class="list-group-item list-group-item-secondary">
          Add to Teams
        </div>
        <div class="list-group-item">
          <%= f.collection_select :team_ids, Team.all, :id, :name, { }, multiple: true, class: 'form-control', data: { selectpicker: true, placeholder: 'Choose Teams' } %>
        </div>
      </div>
    <% end %>
  <% end %>

  <div class="text-xs-center">
    <button type="submit" class="btn btn-primary btn-lg">
      <%= fa_icon 'user', class: 'mr-sm' %><%= @person.new_record? ? 'Add member' : 'Save changes' %>
    </button>
  </div>
<% end %>
